% fname: pir_0_01_poisson__routing_XY__topology_8x8__.m
% ../bin/noxim -pir 0.01 poisson -routing XY -topology MESH -dimx 8 -dimy 8  -warmup 900 -size 8 8 -buffer 4 -config ../config_examples/default_config.yaml -power ../bin/power.yaml 

function [max_pir, max_throughput, min_delay] = pir_0_01_poisson__routing_XY__topology_8x8__(symbol)

data = [
%             sim      avg_delay     throughput      max_delay   total_energy       rpackets         rflits
             1000        23.1935        0.07625             84    8.90676e-07             62            488
             1000         26.623      0.0770312             94    8.95032e-07             61            493
             1000         26.623      0.0770312             94    8.95032e-07             61            493
             1000         26.623      0.0770312             94    8.95032e-07             61            493
             1000         26.623      0.0770312             94    8.95032e-07             61            493
             1000         26.623      0.0770312             94    8.95032e-07             61            493
             1000         26.623      0.0770312             94    8.95032e-07             61            493
             1000        21.3529         0.0875             66     8.8458e-07             68            560
             1000        21.3529         0.0875             66     8.8458e-07             68            560
             1000        21.3529         0.0875             66     8.8458e-07             68            560
             2000        23.5389      0.0832813            125    1.77983e-06            733           5863
             2000        23.5389      0.0832813            125    1.77983e-06            733           5863
             2000        24.0131      0.0780114            108    1.77196e-06            685           5492
             2000        24.0131      0.0780114            108    1.77196e-06            685           5492
             2000        24.0131      0.0780114            108    1.77196e-06            685           5492
             2000        24.0131      0.0780114            108    1.77196e-06            685           5492
             2000        24.4414      0.0799858            101    1.78247e-06            700           5631
             2000        24.4414      0.0799858            101    1.78247e-06            700           5631
             2000        24.4414      0.0799858            101    1.78247e-06            700           5631
             2000        24.4414      0.0799858            101    1.78247e-06            700           5631
             3000        24.1573      0.0813318            101    2.66918e-06           1367          10931
             3000        24.1573      0.0813318            101    2.66918e-06           1367          10931
             3000        24.1573      0.0813318            101    2.66918e-06           1367          10931
             3000        25.0492      0.0809747            124    2.66737e-06           1363          10883
             3000        25.0492      0.0809747            124    2.66737e-06           1363          10883
             3000        25.0492      0.0809747            124    2.66737e-06           1363          10883
             3000        24.4131      0.0785863            139    2.66863e-06           1317          10562
             3000        24.4131      0.0785863            139    2.66863e-06           1317          10562
             3000        24.4131      0.0785863            139    2.66863e-06           1317          10562
             3000        24.5121      0.0834003            121    2.68685e-06           1402          11209
             4000        23.6306        0.08125            121    3.57277e-06           2017          16120
             4000        23.6306        0.08125            121    3.57277e-06           2017          16120
             4000        24.4656      0.0786391            186    3.55476e-06           1950          15602
             4000        24.4656      0.0786391            186    3.55476e-06           1950          15602
             4000        24.8687      0.0797329            154     3.5561e-06           1980          15819
             4000        24.8687      0.0797329            154     3.5561e-06           1980          15819
             4000        24.8687      0.0797329            154     3.5561e-06           1980          15819
             4000        23.6765      0.0791784            177    3.55846e-06           1966          15709
             4000        23.6765      0.0791784            177    3.55846e-06           1966          15709
             4000        24.1893      0.0809325            122     3.5647e-06           2007          16057
             5000        24.1609      0.0808689            133    4.45171e-06           2654          21220
             5000        24.2166      0.0807203            124    4.45111e-06           2646          21181
             5000        24.2166      0.0807203            124    4.45111e-06           2646          21181
             5000        24.0147      0.0810518            126    4.45752e-06           2659          21268
             5000        24.0147      0.0810518            126    4.45752e-06           2659          21268
             5000        24.9087      0.0791425            184    4.44039e-06           2595          20767
             5000        24.9087      0.0791425            184    4.44039e-06           2595          20767
             5000        24.2171      0.0803506            190    4.45279e-06           2635          21084
             5000        24.2171      0.0803506            190    4.45279e-06           2635          21084
             5000        23.4422      0.0800076            116    4.44708e-06           2623          20994
             6000        23.9003      0.0814062            177    5.34512e-06           3320          26571
             6000        25.4918      0.0822641            275    5.35579e-06           3355          26851
             6000        23.4897      0.0773529            160    5.32076e-06           3157          25248
             6000        23.4897      0.0773529            160    5.32076e-06           3157          25248
             6000        23.3501      0.0790717            151    5.32974e-06           3225          25809
             6000        23.3501      0.0790717            151    5.32974e-06           3225          25809
             6000        24.3301      0.0802665            198    5.33625e-06           3272          26199
             6000        25.2392      0.0826072            147    5.36989e-06           3374          26963
             6000        25.2392      0.0826072            147    5.36989e-06           3374          26963
             6000        25.4587      0.0809007            203    5.35262e-06           3305          26406
             7000        24.2681      0.0809836            173    6.23711e-06           3954          31616
             7000        23.9463      0.0808786            160    6.23964e-06           3948          31575
             7000        24.7702      0.0798181            160    6.23089e-06           3899          31161
             7000        23.8319      0.0789139            154     6.2269e-06           3854          30808
             7000        23.9583      0.0781352            241    6.22112e-06           3815          30504
             7000        24.3816      0.0811347            150     6.2325e-06           3960          31675
             7000        24.6887      0.0781045            203    6.22268e-06           3810          30492
             7000        24.6887      0.0781045            203    6.22268e-06           3810          30492
             7000        25.6226      0.0815471            134    6.24676e-06           3983          31836
             7000        23.7067      0.0801895            140    6.22431e-06           3914          31306
             8000        22.5373      0.0769388            171    7.08793e-06           4372          34961
             8000        24.6697      0.0793442            176    7.12052e-06           4508          36054
             8000        25.2623      0.0817892            181      7.145e-06           4644          37165
             8000         24.986      0.0795158            282    7.11843e-06           4516          36132
             8000        24.3322      0.0805326            191     7.1242e-06           4575          36594
             8000        24.7624      0.0815757            163    7.13818e-06           4634          37068
             8000        24.4206      0.0814613            124    7.12873e-06           4629          37016
             8000        24.8313      0.0791901            200    7.11896e-06           4499          35984
             8000        24.6551      0.0798151            139    7.12006e-06           4534          36268
             8000        24.6551      0.0798151            139    7.12006e-06           4534          36268
             9000        24.9607      0.0816667            179    8.03597e-06           5292          42336
             9000        23.9441      0.0802913            172    8.02301e-06           5203          41623
             9000        25.3964      0.0789101            410    8.00885e-06           5116          40907
             9000        24.5456      0.0802894            152    8.01817e-06           5203          41622
             9000        23.2087      0.0796914            126    7.99398e-06           5160          41312
             9000        24.1332      0.0818885            163    8.02329e-06           5307          42451
             9000        24.1204      0.0784896            217    7.99743e-06           5090          40689
             9000        25.9299      0.0803762            196    8.03355e-06           5208          41667
             9000        24.2393      0.0807986            184     8.0251e-06           5237          41886
             9000        24.1859      0.0795544            172    8.00176e-06           5154          41241
            10000        25.7302      0.0814938            157    8.92519e-06           5934          47462
            10000        23.5304      0.0793887            133    8.88885e-06           5779          46236
            10000        24.9949      0.0800532            228    8.90458e-06           5828          46623
            10000        24.7731      0.0806353            194    8.90371e-06           5867          46962
            10000         24.481      0.0800172            234    8.90091e-06           5828          46602
            10000         24.902      0.0811899            215    8.92353e-06           5908          47285
            10000        25.7409      0.0802009            202     8.9132e-06           5835          46709
            10000        24.5366      0.0789475            181    8.89642e-06           5749          45979
            10000        24.1377      0.0776013            270    8.87612e-06           5651          45195
            10000        25.8687      0.0819643            197    8.92599e-06           5971          47736
            11000        24.9272      0.0814821            200    9.80246e-06           6579          52670
            11000        24.3748      0.0801562            175     9.7913e-06           6476          51813
            11000        24.9034      0.0806374            199    9.80168e-06           6513          52124
            11000        24.3494      0.0800665            212    9.79506e-06           6471          51755
            11000        24.6405      0.0807534            218    9.80506e-06           6520          52199
            11000        24.2832      0.0805167            160    9.80257e-06           6505          52046
            11000        24.1944      0.0798128            185    9.79812e-06           6451          51591
            11000        24.2348      0.0792652            167    9.79421e-06           6405          51237
            11000        24.2616      0.0800897            195    9.79616e-06           6469          51770
            11000         23.985      0.0792203            158    9.78863e-06           6400          51208
            12000         25.724      0.0817033            211    1.07076e-05           7258          58042
            12000        24.7757      0.0792708            197    1.06939e-05           7041          56314
            12000        25.0333      0.0804983            182    1.07057e-05           7148          57186
            12000        24.3694      0.0798747            204    1.06799e-05           7092          56743
            12000        23.9739      0.0793694            164    1.06867e-05           7048          56384
            12000        23.9867      0.0795777            169    1.06823e-05           7069          56532
            12000         24.541      0.0791118            151    1.06845e-05           7024          56201
            12000        25.2169      0.0798691            213    1.06818e-05           7095          56739
            12000        23.6791       0.081112            126    1.06885e-05           7204          57622
            12000        24.6341      0.0801985            258    1.06915e-05           7125          56973
            13000        25.4215      0.0805914            209    1.16024e-05           7803          62410
            13000        24.4478      0.0810395            142    1.15954e-05           7840          62757
            13000        24.1841      0.0790586            237    1.15668e-05           7655          61223
            13000        24.9757      0.0816103            184    1.16107e-05           7900          63199
            13000        23.5764      0.0787268            169    1.15482e-05           7623          60966
            13000        25.0005      0.0816167            206    1.16046e-05           7901          63204
            13000        24.6837      0.0811661            235    1.16083e-05           7857          62855
            13000        25.2498      0.0807658            202    1.15966e-05           7819          62545
            13000        24.8708      0.0803512            215    1.15751e-05           7779          62224
            13000        24.3335      0.0810744            172    1.15935e-05           7848          62784
            14000        24.1644      0.0783457            154    1.24365e-05           8212          65685
            14000        24.1089      0.0782956            209    1.24484e-05           8201          65643
            14000        25.5134      0.0808635            224    1.24858e-05           8476          67796
            14000         24.206      0.0795694            190    1.24656e-05           8338          66711
            14000        24.2247      0.0805272            216     1.2487e-05           8439          67514
            14000        24.1609      0.0792879            176    1.24555e-05           8311          66475
            14000        24.4195      0.0801813            282    1.24766e-05           8403          67224
            14000        24.1521      0.0799893            167     1.2472e-05           8383          67063
            14000        24.6825      0.0814218            222    1.24893e-05           8535          68264
            14000        25.3531      0.0812703            184    1.24927e-05           8513          68137
            15000        24.2813      0.0788797            203    1.33385e-05           8899          71181
            15000        24.1285      0.0790126            154    1.33508e-05           8912          71301
            15000        23.9244       0.080615            185    1.33539e-05           9092          72747
            15000        24.5529      0.0790492            225    1.33456e-05           8917          71334
            15000        24.2008      0.0794548            212    1.33539e-05           8963          71700
            15000         24.023      0.0789495            196    1.33393e-05           8905          71244
            15000        24.7614      0.0811536            216    1.33908e-05           9153          73233
            15000        23.6171      0.0801075            202    1.33471e-05           9037          72289
            15000        23.8872      0.0800875            176    1.33685e-05           9032          72271
            15000        25.1154      0.0796975            225    1.33617e-05           8988          71919
            16000        24.4263      0.0799917            208    1.42412e-05           9664          77304
            16000        24.9537      0.0801832            183    1.42649e-05           9686          77489
            16000        23.6555      0.0796223            168    1.42411e-05           9618          76947
            16000        23.9367      0.0799555            205     1.4248e-05           9659          77269
            16000        24.2453       0.080416            207    1.42708e-05           9709          77714
            16000        24.5597      0.0798541            228    1.42451e-05           9648          77171
            16000         23.944      0.0799772            185    1.42444e-05           9661          77290
            16000        24.3533      0.0801221            181    1.42473e-05           9679          77430
            16000        23.7189      0.0778104            184     1.4212e-05           9399          75196
            16000        25.5654       0.080743            299    1.42855e-05           9752          78030
            17000        24.3967      0.0805503            205    1.51619e-05          10372          82999
            17000        23.9345      0.0789237            174    1.51193e-05          10165          81323
            17000        25.0005      0.0801203            372    1.51493e-05          10317          82556
            17000        23.8161      0.0791799            166     1.5123e-05          10193          81587
            17000        24.8498       0.079671            222    1.51364e-05          10260          82093
            17000        24.4888      0.0804241            196    1.51473e-05          10359          82869
            17000        24.1036      0.0800912            172    1.51477e-05          10318          82526
            17000        24.5963      0.0788839            183    1.51114e-05          10158          81282
            17000        24.3701      0.0806337            279    1.51608e-05          10386          83085
            17000        24.1569       0.080067            195    1.51433e-05          10312          82501
            18000        23.8625      0.0798995            145    1.60386e-05          10927          87442
            18000        24.2093       0.079651            168    1.60273e-05          10896          87170
            18000        24.4914      0.0794591            244    1.60313e-05          10868          86960
            18000        24.3872      0.0802604            185    1.60358e-05          10984          87837
            18000        24.4422      0.0797387            210    1.60327e-05          10909          87266
            18000        24.7384      0.0790287            244    1.60057e-05          10809          86489
            18000        24.3966      0.0793512            218    1.60145e-05          10856          86842
            18000        25.1224      0.0807429            291    1.60464e-05          11043          88365
            18000         24.254      0.0791959            194    1.60196e-05          10835          86672
            18000        23.6769      0.0792114            179    1.60187e-05          10836          86689
            19000         24.789      0.0798265            283    1.69413e-05          11560          92471
            19000        24.9811      0.0818094            234    1.69482e-05          11847          94768
            19000        24.7238      0.0804877            229    1.69219e-05          11654          93237
            19000        25.3148      0.0806354            219    1.69512e-05          11674          93408
            19000          24.35      0.0799724            176    1.69159e-05          11580          92640
            19000        24.0503       0.079438            201    1.69171e-05          11500          92021
            19000        24.5721      0.0795994            198    1.69147e-05          11525          92208
            19000        24.8379      0.0808037            181    1.69411e-05          11703          93603
            19000        23.9572      0.0786291            180    1.68924e-05          11389          91084
            19000        24.6794      0.0809504            215    1.69553e-05          11721          93773
            20000        23.7913      0.0797358            282    1.78029e-05          12183          97469
            20000         24.072      0.0799656            168    1.78168e-05          12219          97750
            20000        24.2217      0.0799607            169    1.78071e-05          12219          97744
            20000        24.5391      0.0783418            298    1.77925e-05          11970          95765
            20000        24.3534      0.0794355            208    1.78224e-05          12136          97102
            20000        24.1924      0.0796744            262    1.78187e-05          12173          97394
            20000        24.5641      0.0795476            181    1.78024e-05          12157          97239
            20000        25.2119      0.0805686            253    1.78318e-05          12310          98487
            20000        25.2786      0.0800074            241    1.78128e-05          12224          97801
            20000        25.1047      0.0787974            185    1.77919e-05          12038          96322
];

rows = size(data, 1);
cols = size(data, 2);

data_delay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+1);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_delay = [data_delay; data(ifirst, 1:cols-6), avg ci];
end

fig1 = figure(1);
set(fig1,'Name','data_delay');
hold on;
plot(data_delay(:,1), data_delay(:,2), symbol);

data_throughput = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+2);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_throughput = [data_throughput; data(ifirst, 1:cols-6), avg ci];
end

fig2 = figure(2);
set(fig2,'Name','data_throughput');
hold on;
plot(data_throughput(:,1), data_throughput(:,2), symbol);

data_maxdelay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+3);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_maxdelay = [data_maxdelay; data(ifirst, 1:cols-6), avg ci];
end

fig3 = figure(3);
set(fig3,'Name','data_maxdelay');
hold on;
plot(data_maxdelay(:,1), data_maxdelay(:,2), symbol);

data_totalenergy = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+4);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_totalenergy = [data_totalenergy; data(ifirst, 1:cols-6), avg ci];
end

fig4 = figure(4);
set(fig4,'Name','data_totalenergy');
hold on;
plot(data_totalenergy(:,1), data_totalenergy(:,2), symbol);


%-------- Saturation Analysis -----------
slope=[];
for i=2:size(data_throughput,1),
    slope(i-1) = (data_throughput(i,2)-data_throughput(i-1,2))/(data_throughput(i,1)-data_throughput(i-1,1));
end

for i=2:size(slope,2),
    if slope(i) < (0.95*mean(slope(1:i)))
        max_pir = data_throughput(i, 1);
        max_throughput = data_throughput(i, 2);
        min_delay = data_delay(i, 2);
        break;
    end
end
