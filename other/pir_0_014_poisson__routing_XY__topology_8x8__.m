% fname: pir_0_014_poisson__routing_XY__topology_8x8__.m
% ../bin/noxim -pir 0.014 poisson -routing XY -topology MESH -dimx 8 -dimy 8  -warmup 900 -size 8 8 -buffer 4 -config ../config_examples/default_config.yaml -power ../bin/power.yaml 

function [max_pir, max_throughput, min_delay] = pir_0_014_poisson__routing_XY__topology_8x8__(symbol)

data = [
%             sim      avg_delay     throughput      max_delay   total_energy       rpackets         rflits
             1000        66.2771       0.107813            489    9.25956e-07             83            690
             1000        48.9556       0.116094            231    9.28996e-07             90            743
             1000        48.9556       0.116094            231    9.28996e-07             90            743
             1000        48.9556       0.116094            231    9.28996e-07             90            743
             1000        48.9556       0.116094            231    9.28996e-07             90            743
             1000        48.9556       0.116094            231    9.28996e-07             90            743
             1000        40.0899       0.108594            232    9.23954e-07             89            695
             1000        40.0899       0.108594            232    9.23954e-07             89            695
             1000        40.0899       0.108594            232    9.23954e-07             89            695
             1000        40.0899       0.108594            232    9.23954e-07             89            695
             2000        43.6229       0.109233            260     1.8638e-06            960           7690
             2000        43.6229       0.109233            260     1.8638e-06            960           7690
             2000        43.6229       0.109233            260     1.8638e-06            960           7690
             2000         50.005       0.114631            278    1.86676e-06           1007           8070
             2000         50.005       0.114631            278    1.86676e-06           1007           8070
             2000         50.005       0.114631            278    1.86676e-06           1007           8070
             2000        49.7358       0.113764            282    1.86033e-06           1003           8009
             2000        49.7358       0.113764            282    1.86033e-06           1003           8009
             2000         38.132       0.113693            199    1.85934e-06           1000           8004
             2000         38.132       0.113693            199    1.85934e-06           1000           8004
             3000        38.1429       0.112671            220    2.78948e-06           1890          15143
             3000        44.9865       0.110164            515    2.78434e-06           1851          14806
             3000        44.9865       0.110164            515    2.78434e-06           1851          14806
             3000        36.7172       0.109606            231      2.779e-06           1842          14731
             3000        36.7172       0.109606            231      2.779e-06           1842          14731
             3000        44.0809       0.113951            473    2.79811e-06           1917          15315
             3000        46.0558       0.112024            324    2.78957e-06           1882          15056
             3000        46.0558       0.112024            324    2.78957e-06           1882          15056
             3000        42.1856       0.113795            374    2.78769e-06           1913          15294
             3000        42.1856       0.113795            374    2.78769e-06           1913          15294
             4000        38.7458       0.111588            246    3.72258e-06           2770          22139
             4000        38.7458       0.111588            246    3.72258e-06           2770          22139
             4000        52.7308       0.112147            452    3.72539e-06           2782          22250
             4000        38.6532       0.110514            359    3.71587e-06           2739          21926
             4000        38.6532       0.110514            359    3.71587e-06           2739          21926
             4000        49.0256       0.114869            473    3.73131e-06           2847          22790
             4000        46.2826        0.11377            510    3.72271e-06           2820          22572
             4000        46.2826        0.11377            510    3.72271e-06           2820          22572
             4000        39.0127       0.111139            395    3.71648e-06           2753          22050
             4000        39.3662       0.109577            265    3.71212e-06           2714          21740
             5000        40.2311       0.109558            352    4.64063e-06           3592          28748
             5000        45.2324       0.113594            459    4.66547e-06           3726          29807
             5000        40.6576       0.109825            359    4.64298e-06           3604          28818
             5000        50.7599       0.112912            567    4.66424e-06           3703          29628
             5000        47.6766       0.114546            668    4.67237e-06           3760          30057
             5000        47.6766       0.114546            668    4.67237e-06           3760          30057
             5000        40.9254       0.110785            400    4.63376e-06           3634          29070
             5000        44.4644       0.108342            471    4.64185e-06           3553          28429
             5000        38.6824       0.110774            318    4.64105e-06           3633          29067
             5000        42.6009       0.112961            338    4.65805e-06           3708          29641
             6000        42.8468       0.112286            340     5.5878e-06           4583          36650
             6000        49.0314        0.10943            469     5.5684e-06           4463          35718
             6000        44.3205        0.10936            535    5.57335e-06           4465          35695
             6000        46.6185       0.114874            488    5.60837e-06           4689          37495
             6000        46.9907       0.113367            423    5.60075e-06           4622          37003
             6000         41.069       0.112463            412    5.59248e-06           4591          36708
             6000        41.0175       0.111884            404     5.5856e-06           4564          36519
             6000        41.4521       0.112858            370    5.59651e-06           4601          36837
             6000        50.7436       0.114347            444    5.59745e-06           4668          37323
             6000        40.8642       0.111284            546    5.56478e-06           4543          36323
             7000        48.0347        0.11395            666    6.53874e-06           5561          44486
             7000        41.7287       0.109047            386    6.49298e-06           5323          42572
             7000        46.1262       0.113712            529    6.53685e-06           5548          44393
             7000         46.723       0.110471            573    6.50834e-06           5390          43128
             7000        48.0616       0.114626            489     6.5434e-06           5597          44750
             7000        43.6113       0.110602            324    6.50763e-06           5398          43179
             7000        45.6359       0.113932            576    6.52394e-06           5559          44479
             7000        42.7432       0.111442            458    6.49953e-06           5436          43507
             7000        49.4434       0.111565            596    6.51385e-06           5446          43555
             7000        42.9719        0.11168            632    6.50662e-06           5452          43600
             8000        44.9754       0.110112            522    7.43897e-06           6255          50035
             8000        42.4786       0.111893            347     7.4421e-06           6358          50844
             8000         45.094       0.111884            379    7.45325e-06           6354          50840
             8000        43.2368        0.11327            453     7.4581e-06           6436          51470
             8000        39.9452       0.110271            369    7.44582e-06           6262          50107
             8000        40.0723       0.109091            335    7.42404e-06           6197          49571
             8000         44.464       0.112405            375     7.4442e-06           6388          51077
             8000        45.2549       0.113873            604    7.46447e-06           6470          51744
             8000        39.8777       0.112014            311    7.44486e-06           6363          50899
             8000          48.23       0.113669            478    7.46555e-06           6457          51651
             9000        47.2069       0.111557            610    8.39876e-06           7229          57831
             9000        44.6198       0.112751            477    8.38077e-06           7305          58450
             9000        43.8264       0.111896            401     8.3892e-06           7253          58007
             9000        43.9261       0.111485            395    8.38409e-06           7225          57794
             9000        39.1749       0.110793            359    8.36859e-06           7182          57435
             9000        50.1592       0.113326            588    8.39603e-06           7342          58748
             9000        45.6773       0.113146            562    8.38897e-06           7333          58655
             9000        47.1896       0.113409            575    8.41114e-06           7354          58791
             9000        43.4832       0.112629            482    8.39942e-06           7297          58387
             9000        40.7376       0.114402            560    8.39911e-06           7413          59306
            10000        46.5335       0.112653            609    9.32348e-06           8203          65609
            10000        41.9488       0.110694            389    9.30076e-06           8062          64468
            10000        43.8191       0.113053            505    9.33268e-06           8229          65842
            10000        47.9085       0.112582            410    9.32525e-06           8195          65568
            10000        48.1337       0.113295            570    9.33861e-06           8251          65983
            10000        40.3236       0.111947            458    9.30138e-06           8150          65198
            10000         47.169       0.112885            376    9.34322e-06           8217          65744
            10000        46.5728       0.114181            449     9.3407e-06           8313          66499
            10000        48.4509       0.113353            445    9.33155e-06           8254          66017
            10000        49.4967       0.111921            494    9.32143e-06           8148          65183
            11000        42.8462       0.112008            597    1.02521e-05           9053          72402
            11000        48.3588       0.112551            615    1.02517e-05           9093          72753
            11000        50.3337       0.114069            616    1.02735e-05           9212          73734
            11000        43.7501       0.112005            470    1.02392e-05           9051          72400
            11000        44.3005       0.112867            535    1.02621e-05           9121          72957
            11000        46.9597       0.115158            562    1.02845e-05           9304          74438
            11000        46.9285       0.113419            682    1.02622e-05           9166          73314
            11000         44.287       0.114457            410    1.02773e-05           9251          73985
            11000        40.5911       0.111259            374     1.0245e-05           8990          71918
            11000        47.3041        0.11351            571    1.02788e-05           9170          73373
            12000        45.0956       0.111865            487    1.11704e-05           9936          79469
            12000        45.3791       0.112363            533    1.11776e-05           9980          79823
            12000        43.3371       0.111554            441    1.11776e-05           9905          79248
            12000        44.5932       0.111291            426    1.11622e-05           9879          79061
            12000        47.8298       0.112489            529    1.11858e-05           9991          79912
            12000        47.5817       0.111841            770    1.11849e-05           9933          79452
            12000         44.674       0.112452            397    1.11784e-05           9985          79886
            12000        44.2741       0.113366            431    1.11982e-05          10065          80535
            12000        43.8385       0.114085            374    1.12155e-05          10126          81046
            12000        44.7577       0.111592            409    1.11676e-05           9908          79275
            13000         40.801       0.111932            359    1.21049e-05          10831          86680
            13000        44.4141       0.113744            567    1.21437e-05          11005          88083
            13000        41.1211       0.110529            400    1.20832e-05          10698          85594
            13000        43.1767       0.111259            420    1.20949e-05          10772          86159
            13000        43.4513       0.112244            385    1.21186e-05          10867          86922
            13000        42.6809       0.112039            435    1.21097e-05          10849          86763
            13000        43.5398       0.113481            465    1.21181e-05          10984          87880
            13000        44.2951       0.112894            530    1.21309e-05          10927          87425
            13000         51.914       0.112448            814    1.21138e-05          10884          87080
            13000        46.3778       0.111879            727    1.21094e-05          10829          86639
            14000        43.5069       0.110576            539    1.30297e-05          11582          92707
            14000         46.824       0.112023           1288    1.30509e-05          11742          93920
            14000        40.8785       0.111918            418    1.30396e-05          11732          93832
            14000        41.5214       0.110429            414    1.30211e-05          11573          92584
            14000          43.33       0.110923            433    1.30081e-05          11623          92998
            14000         43.392       0.112223            361    1.30518e-05          11759          94088
            14000        45.8676        0.11222            443    1.30525e-05          11761          94085
            14000        47.1067        0.11277            650    1.30524e-05          11820          94546
            14000         43.174       0.112148            510    1.30523e-05          11749          94025
            14000        47.0133       0.113455            610    1.30703e-05          11889          95121
            15000        39.0609       0.111775            345     1.3955e-05          12608         100866
            15000        43.5414        0.11179            412    1.39668e-05          12609         100879
            15000        45.8298       0.113264            533    1.40081e-05          12777         102209
            15000        41.4409       0.110814            492    1.39451e-05          12506          99999
            15000        42.2938          0.113            476    1.39817e-05          12746         101971
            15000        41.6949       0.111637            339    1.39732e-05          12596         100741
            15000        45.5165       0.112169            467    1.39772e-05          12651         101221
            15000        46.7961       0.112461            515    1.39893e-05          12688         101485
            15000        43.1572       0.111784            572    1.39867e-05          12609         100874
            15000        41.4267        0.11111            408    1.39533e-05          12533         100266
            16000        42.4546       0.111471            486    1.48783e-05          13470         107726
            16000        42.7869       0.111775            524    1.49075e-05          13502         108019
            16000        45.0737        0.11209            799    1.49091e-05          13539         108324
            16000        42.3471       0.112667            423    1.49111e-05          13613         108881
            16000        44.9329       0.112514            552    1.49118e-05          13586         108734
            16000        49.3325       0.112656            710    1.49232e-05          13607         108871
            16000        38.5985       0.110263            352    1.48774e-05          13319         106558
            16000        40.6401        0.11094            482     1.4874e-05          13400         107212
            16000        48.8855       0.113728            510      1.495e-05          13738         109907
            16000        42.2411       0.111796            396    1.49026e-05          13506         108040
            17000        43.4251       0.111236            409    1.58031e-05          14326         114618
            17000        44.6844       0.111852            572    1.58322e-05          14409         115252
            17000         43.295       0.111037            611    1.58301e-05          14301         114413
            17000        42.1206       0.110995            517    1.58285e-05          14296         114369
            17000        45.7412       0.113098            683    1.58626e-05          14564         116536
            17000        42.3558       0.111694            483    1.58391e-05          14389         115089
            17000        44.0329       0.111004            654    1.58139e-05          14300         114379
            17000        43.7083       0.112514            488    1.58285e-05          14491         115934
            17000        41.4585       0.110827            519    1.57967e-05          14272         114196
            17000         43.351       0.109873            417    1.58112e-05          14150         113213
            18000        43.4749       0.112916            529    1.67815e-05          15448         123575
            18000        45.1866       0.112117           1133     1.6772e-05          15335         122701
            18000        41.7241       0.112043            448    1.67733e-05          15328         122620
            18000        43.7617       0.112139            454    1.67674e-05          15340         122725
            18000        45.8622       0.112072            416    1.67911e-05          15325         122652
            18000        46.0076       0.113592            511    1.67916e-05          15539         124315
            18000        41.2397       0.112174            396    1.67602e-05          15347         122763
            18000         42.451       0.111785            466    1.67666e-05          15292         122338
            18000         44.808       0.111903            543    1.67791e-05          15304         122467
            18000        46.8512       0.112787            515    1.67878e-05          15433         123434
            19000         41.254       0.111783            403    1.76919e-05          16188         129489
            19000        43.6837       0.112597            471    1.76986e-05          16305         130432
            19000        45.4668        0.11188            525     1.7719e-05          16199         129602
            19000        47.9838       0.111487            687     1.7699e-05          16144         129147
            19000        44.3372       0.111989            595    1.77048e-05          16220         129728
            19000        48.6418       0.112936            516    1.77242e-05          16354         130825
            19000        45.4679       0.112194            445    1.76964e-05          16246         129966
            19000        43.8033       0.111252            504    1.76902e-05          16111         128874
            19000        42.0455       0.111417            856    1.76934e-05          16133         129066
            19000        41.7958       0.111443            492    1.76882e-05          16135         129096
            20000        41.5854       0.111297            463    1.86129e-05          17005         136050
            20000         43.454       0.111538            453    1.86277e-05          17043         136344
            20000        43.9877       0.112134            565    1.86376e-05          17130         137073
            20000        41.0121       0.110181            606    1.85978e-05          16837         134685
            20000        43.6942       0.112709            505    1.86603e-05          17225         137776
            20000        42.2087       0.112179            465    1.86439e-05          17142         137128
            20000        43.9709       0.111436            585    1.86139e-05          17029         136219
            20000        46.5281        0.11255            522    1.86544e-05          17199         137581
            20000        43.4329       0.111467            566    1.86116e-05          17035         136257
            20000        43.3084       0.112861            427    1.86485e-05          17246         137961
];

rows = size(data, 1);
cols = size(data, 2);

data_delay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+1);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_delay = [data_delay; data(ifirst, 1:cols-6), avg ci];
end

fig1 = figure(1);
set(fig1,'Name','data_delay');
hold on;
plot(data_delay(:,1), data_delay(:,2), symbol);

data_throughput = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+2);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_throughput = [data_throughput; data(ifirst, 1:cols-6), avg ci];
end

fig2 = figure(2);
set(fig2,'Name','data_throughput');
hold on;
plot(data_throughput(:,1), data_throughput(:,2), symbol);

data_maxdelay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+3);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_maxdelay = [data_maxdelay; data(ifirst, 1:cols-6), avg ci];
end

fig3 = figure(3);
set(fig3,'Name','data_maxdelay');
hold on;
plot(data_maxdelay(:,1), data_maxdelay(:,2), symbol);

data_totalenergy = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+4);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_totalenergy = [data_totalenergy; data(ifirst, 1:cols-6), avg ci];
end

fig4 = figure(4);
set(fig4,'Name','data_totalenergy');
hold on;
plot(data_totalenergy(:,1), data_totalenergy(:,2), symbol);


%-------- Saturation Analysis -----------
slope=[];
for i=2:size(data_throughput,1),
    slope(i-1) = (data_throughput(i,2)-data_throughput(i-1,2))/(data_throughput(i,1)-data_throughput(i-1,1));
end

for i=2:size(slope,2),
    if slope(i) < (0.95*mean(slope(1:i)))
        max_pir = data_throughput(i, 1);
        max_throughput = data_throughput(i, 2);
        min_delay = data_delay(i, 2);
        break;
    end
end
