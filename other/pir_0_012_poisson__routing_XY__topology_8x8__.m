% fname: pir_0_012_poisson__routing_XY__topology_8x8__.m
% ../bin/noxim -pir 0.012 poisson -routing XY -topology MESH -dimx 8 -dimy 8  -warmup 900 -size 8 8 -buffer 4 -config ../config_examples/default_config.yaml -power ../bin/power.yaml 

function [max_pir, max_throughput, min_delay] = pir_0_012_poisson__routing_XY__topology_8x8__(symbol)

data = [
%             sim      avg_delay     throughput      max_delay   total_energy       rpackets         rflits
             1000        52.0395      0.0979687            297    9.04199e-07             76            627
             1000        52.0395      0.0979687            297    9.04199e-07             76            627
             1000        29.2692      0.0939062             77    9.06937e-07             78            601
             1000        29.2692      0.0939062             77    9.06937e-07             78            601
             1000        29.2692      0.0939062             77    9.06937e-07             78            601
             1000        29.2692      0.0939062             77    9.06937e-07             78            601
             1000        33.5263      0.0946875            139    9.06926e-07             76            606
             1000        33.5263      0.0946875            139    9.06926e-07             76            606
             1000        33.5263      0.0946875            139    9.06926e-07             76            606
             1000        33.5263      0.0946875            139    9.06926e-07             76            606
             2000        27.0508      0.0893892            200    1.80864e-06            788           6293
             2000        34.7678        0.10044            307    1.82017e-06            887           7071
             2000        34.7678        0.10044            307    1.82017e-06            887           7071
             2000        34.7678        0.10044            307    1.82017e-06            887           7071
             2000        33.6085       0.101491            232    1.82564e-06            894           7145
             2000        33.6085       0.101491            232    1.82564e-06            894           7145
             2000        33.6085       0.101491            232    1.82564e-06            894           7145
             2000        30.2839      0.0979119            221    1.83164e-06            863           6893
             2000        30.2839      0.0979119            221    1.83164e-06            863           6893
             2000        30.2839      0.0979119            221    1.83164e-06            863           6893
             3000        27.4744      0.0917113            145    2.71791e-06           1543          12326
             3000        27.4744      0.0917113            145    2.71791e-06           1543          12326
             3000        31.1008      0.0945164            206    2.73596e-06           1588          12703
             3000        31.1008      0.0945164            206    2.73596e-06           1588          12703
             3000         38.146      0.0979167            375    2.74146e-06           1644          13160
             3000         38.146      0.0979167            375    2.74146e-06           1644          13160
             3000        30.1824      0.0985268            159    2.73571e-06           1656          13242
             3000        30.1824      0.0985268            159    2.73571e-06           1656          13242
             3000        30.1824      0.0985268            159    2.73571e-06           1656          13242
             3000        29.5124      0.0990179            232    2.73457e-06           1659          13308
             4000        28.2902      0.0976562            232    3.64076e-06           2419          19375
             4000        30.5623      0.0933165            345    3.63119e-06           2312          18514
             4000        30.5623      0.0933165            345    3.63119e-06           2312          18514
             4000        28.5791      0.0962399            213    3.64753e-06           2388          19094
             4000        30.5544      0.0970161            263    3.63914e-06           2408          19248
             4000        30.5544      0.0970161            263    3.63914e-06           2408          19248
             4000         31.987      0.0931956            236    3.63801e-06           2314          18490
             4000         31.987      0.0931956            236    3.63801e-06           2314          18490
             4000        28.8762      0.0947782            184    3.63095e-06           2351          18804
             4000        28.8762      0.0947782            184    3.63095e-06           2351          18804
             5000         29.514      0.0961662            217    4.55483e-06           3154          25234
             5000        29.2067      0.0948285            184     4.5444e-06           3106          24883
             5000        29.2067      0.0948285            184     4.5444e-06           3106          24883
             5000        33.9467      0.0985404            260    4.56646e-06           3230          25857
             5000        28.7887      0.0938338            164    4.54542e-06           3081          24622
             5000        28.7887      0.0938338            164    4.54542e-06           3081          24622
             5000        28.7926      0.0926296            352    4.54821e-06           3038          24306
             5000        29.8861      0.0953201            251    4.55238e-06           3125          25012
             5000        32.3333      0.0955678            310    4.54411e-06           3132          25077
             5000        32.3333      0.0955678            310    4.54411e-06           3132          25077
             6000        32.3819      0.0968627            243    5.47637e-06           3954          31616
             6000        30.2238      0.0955239            316    5.46453e-06           3896          31179
             6000        29.0597       0.095527            224    5.45809e-06           3901          31180
             6000        29.0597       0.095527            224    5.45809e-06           3901          31180
             6000        29.1409      0.0939553            201    5.44699e-06           3832          30667
             6000        28.5192      0.0930453            204    5.44539e-06           3798          30370
             6000        29.4685      0.0941513            310     5.4532e-06           3844          30731
             6000        31.3784      0.0942586            311    5.45548e-06           3843          30766
             6000        31.3784      0.0942586            311    5.45548e-06           3843          30766
             6000        30.5143      0.0958364            257    5.46812e-06           3910          31281
             7000        30.3153        0.09521            249    6.37319e-06           4647          37170
             7000        29.8653      0.0957966            247    6.37649e-06           4677          37399
             7000        29.4023      0.0963038            234    6.36677e-06           4700          37597
             7000        29.4751      0.0934785            227    6.36024e-06           4563          36494
             7000         30.477       0.095584            266    6.37577e-06           4669          37316
             7000        28.5699      0.0947387            274    6.36259e-06           4624          36986
             7000        28.5699      0.0947387            274    6.36259e-06           4624          36986
             7000         29.656      0.0963499            217    6.37856e-06           4700          37615
             7000        29.7834      0.0940651            220    6.36081e-06           4594          36723
             7000         32.067      0.0976153            342    6.39282e-06           4763          38109
             8000        29.1994      0.0947711            229    7.26429e-06           5382          43064
             8000        30.8738      0.0970048            265    7.29946e-06           5509          44079
             8000         29.147      0.0948041            324    7.28546e-06           5387          43079
             8000        31.6957      0.0970401            297    7.29747e-06           5511          44095
             8000        31.5385      0.0958561            394    7.27551e-06           5443          43557
             8000        29.9899      0.0963688            237    7.28405e-06           5472          43790
             8000        28.5182      0.0936576            209    7.25983e-06           5318          42558
             8000        33.1714      0.0979555            332    7.30604e-06           5565          44511
             8000        30.4337      0.0957328            237    7.28993e-06           5439          43501
             8000        30.3997      0.0954093            246    7.27759e-06           5421          43354
             9000        31.5757      0.0981057            316    8.21676e-06           6356          50858
             9000        32.8412       0.096468            352    8.21407e-06           6252          50009
             9000        34.4546       0.097772            285    8.21397e-06           6335          50685
             9000         31.684      0.0959684            237    8.20383e-06           6218          49750
             9000        30.6869      0.0964911            261    8.18967e-06           6253          50021
             9000        30.2017       0.095733            258    8.19102e-06           6202          49628
             9000        29.8041      0.0950675            285    8.17795e-06           6160          49283
             9000        30.1022      0.0967226            287    8.21241e-06           6269          50141
             9000        29.5462      0.0942477            189    8.18073e-06           6108          48858
             9000        29.0247      0.0956192            328    8.18506e-06           6196          49569
            10000        29.7236      0.0955512            300    9.09594e-06           6960          55649
            10000        29.1157      0.0940041            241    9.07283e-06           6844          54748
            10000         31.667      0.0975052            297    9.12864e-06           7099          56787
            10000         29.924       0.094715            229    9.10138e-06           6892          55162
            10000        32.1808      0.0985319            268     9.1354e-06           7174          57385
            10000        27.8934      0.0946102            197     9.0842e-06           6888          55101
            10000        31.8797      0.0966638            222     9.1128e-06           7034          56297
            10000        29.6976      0.0935663            256    9.07748e-06           6815          54493
            10000        31.7819      0.0976442            283    9.13483e-06           7108          56868
            10000        32.0649      0.0963152            390     9.1188e-06           7010          56094
            11000        32.3476      0.0967435            305    1.00345e-05           7817          62535
            11000        31.0293      0.0951501            241     1.0007e-05           7692          61505
            11000        29.2171      0.0948298            279    1.00059e-05           7663          61298
            11000        31.4795      0.0954084            266    1.00148e-05           7710          61672
            11000        32.3697      0.0982797            381    1.00491e-05           7939          63528
            11000        30.8061       0.095888            231     1.0014e-05           7748          61982
            11000        30.8462      0.0967543            325    1.00145e-05           7820          62542
            11000        31.6847      0.0964325            263    1.00278e-05           7793          62334
            11000        29.1447      0.0960226            213    1.00063e-05           7759          62069
            11000         30.493      0.0941414            266    9.99019e-06           7605          60853
            12000        30.5773      0.0960163            229    1.09265e-05           8528          68210
            12000        31.3418      0.0958277            326    1.09287e-05           8509          68076
            12000        30.6987        0.09519            229    1.09045e-05           8453          67623
            12000         30.954      0.0958981            291    1.09392e-05           8517          68126
            12000        30.6325      0.0971593            220    1.09522e-05           8626          69022
            12000        31.5916      0.0961008            336    1.09316e-05           8534          68270
            12000        31.7735      0.0961796            262    1.09436e-05           8543          68326
            12000        32.1899      0.0951014            297    1.09257e-05           8448          67560
            12000        30.8022      0.0966962            316    1.09375e-05           8584          68693
            12000        30.6372      0.0958094            290    1.09361e-05           8508          68063
            13000        30.1079      0.0958355            345    1.18345e-05           9276          74215
            13000        30.8405      0.0955527            381    1.18226e-05           9248          73996
            13000        30.9698      0.0953151            220    1.18349e-05           9228          73812
            13000        31.2757      0.0969008            290      1.187e-05           9383          75040
            13000        29.8618      0.0941219            212    1.18162e-05           9110          72888
            13000        30.2913       0.096383            252    1.18555e-05           9331          74639
            13000        31.0573      0.0950529            353    1.18275e-05           9201          73609
            13000        30.9446      0.0954765            236    1.18149e-05           9244          73937
            13000        31.7526        0.09664            241    1.18465e-05           9354          74838
            13000        30.0431      0.0964153            292    1.18342e-05           9331          74664
            14000        32.0403      0.0963251            387    1.27766e-05          10092          80759
            14000         32.024      0.0981035            308    1.28012e-05          10279          82250
            14000        30.9929      0.0971374            302    1.27847e-05          10182          81440
            14000        31.9358      0.0966305            412    1.27455e-05          10128          81015
            14000        31.6612      0.0980427            283    1.27802e-05          10272          82199
            14000        30.9221      0.0959482            295    1.27449e-05          10060          80443
            14000        31.2482      0.0950191            373    1.27432e-05           9960          79664
            14000        31.4083       0.095755            276    1.27325e-05          10037          80281
            14000        31.4132      0.0979604            384    1.27975e-05          10265          82130
            14000        31.9187      0.0962393            341    1.27639e-05          10085          80687
            15000        30.6924      0.0948216            359    1.36435e-05          10693          85567
            15000        30.3467      0.0969659            226    1.36823e-05          10939          87502
            15000         31.112      0.0968307            383    1.36739e-05          10925          87380
            15000         30.335      0.0954843            231    1.36656e-05          10769          86165
            15000        31.3345      0.0964816            364    1.36719e-05          10885          87065
            15000         31.329      0.0966512            300    1.36611e-05          10904          87218
            15000        30.8424      0.0954721            447    1.36488e-05          10769          86154
            15000        29.7469      0.0948072            272    1.36406e-05          10697          85554
            15000        30.3132      0.0958422            360    1.36471e-05          10812          86488
            15000        29.8752      0.0951762            281    1.36576e-05          10735          85887
            16000        30.0903      0.0958351            264     1.4575e-05          11578          92615
            16000         29.931      0.0953777            318    1.45597e-05          11520          92173
            16000        31.2369      0.0970685            265    1.46174e-05          11727          93807
            16000        28.8958      0.0944298            223    1.45368e-05          11405          91257
            16000        32.0962      0.0972351            366    1.46199e-05          11747          93968
            16000        30.7694      0.0970054            262    1.46023e-05          11718          93746
            16000        30.5287      0.0950455            351    1.45451e-05          11480          91852
            16000        31.3789      0.0958878            582    1.45697e-05          11583          92666
            16000        30.9678      0.0957906            303    1.45729e-05          11577          92572
            16000        31.4688      0.0971947            243    1.45988e-05          11743          93929
            17000          28.98      0.0953804            285    1.54643e-05          12286          98280
            17000        31.9187      0.0958686            351    1.54841e-05          12345          98783
            17000        29.9836      0.0957657            228     1.5481e-05          12336          98677
            17000        30.6604      0.0959346            252    1.54773e-05          12354          98851
            17000        29.6708      0.0956764            237    1.54788e-05          12320          98585
            17000        31.0914       0.097336            292    1.55158e-05          12538         100295
            17000        30.6728      0.0953513            231    1.54791e-05          12283          98250
            17000        30.1366      0.0944827            378    1.54575e-05          12173          97355
            17000        34.7089      0.0983764            741    1.55512e-05          12665         101367
            17000        30.4866      0.0949146            260    1.54672e-05          12224          97800
            18000        29.9563       0.095572            236    1.63721e-05          13076         104594
            18000         31.537      0.0974735            296    1.64331e-05          13332         106675
            18000        31.5757      0.0958946            312    1.64016e-05          13116         104947
            18000        31.7105       0.096716            409    1.64039e-05          13231         105846
            18000        30.3031      0.0960079            280    1.63867e-05          13134         105071
            18000        31.0566      0.0958141            443    1.63874e-05          13109         104859
            18000        31.5732      0.0969508            329    1.64222e-05          13259         106103
            18000        30.9115       0.096504            258     1.6401e-05          13202         105614
            18000        31.0778      0.0956067            234    1.64002e-05          13077         104632
            18000        31.3142      0.0968211            281    1.64224e-05          13245         105961
            19000        30.0593      0.0943957            336     1.7275e-05          13666         109348
            19000        29.5741       0.095019            241    1.72822e-05          13760         110070
            19000        30.0401      0.0951675            283     1.7283e-05          13782         110242
            19000        30.9099       0.096111            330    1.73079e-05          13922         111335
            19000        29.7095      0.0942585            250    1.72763e-05          13647         109189
            19000        31.0139      0.0965124            272    1.73242e-05          13973         111800
            19000        31.4188        0.09697            330    1.73383e-05          14044         112330
            19000        31.4365      0.0964287            249    1.73277e-05          13962         111703
            19000        31.1245      0.0956906            391    1.72914e-05          13855         110848
            19000        30.3866      0.0954722            331    1.72918e-05          13823         110595
            20000        30.4341       0.096529            233    1.82276e-05          14750         117997
            20000        30.7871      0.0967899            414    1.82457e-05          14793         118316
            20000        29.9675      0.0958483            228    1.82247e-05          14645         117165
            20000        30.5516      0.0957477            255    1.81979e-05          14631         117042
            20000          31.01      0.0964782            337    1.82377e-05          14742         117935
            20000        31.9102      0.0971016            320     1.8265e-05          14841         118697
            20000        30.5863      0.0964431            313    1.82275e-05          14736         117892
            20000        31.4201      0.0967637            332    1.82465e-05          14786         118284
            20000        31.2397      0.0971261            259    1.82527e-05          14842         118727
            20000        30.7186      0.0952266            263    1.82001e-05          14551         116405
];

rows = size(data, 1);
cols = size(data, 2);

data_delay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+1);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_delay = [data_delay; data(ifirst, 1:cols-6), avg ci];
end

fig1 = figure(1);
set(fig1,'Name','data_delay');
hold on;
plot(data_delay(:,1), data_delay(:,2), symbol);

data_throughput = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+2);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_throughput = [data_throughput; data(ifirst, 1:cols-6), avg ci];
end

fig2 = figure(2);
set(fig2,'Name','data_throughput');
hold on;
plot(data_throughput(:,1), data_throughput(:,2), symbol);

data_maxdelay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+3);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_maxdelay = [data_maxdelay; data(ifirst, 1:cols-6), avg ci];
end

fig3 = figure(3);
set(fig3,'Name','data_maxdelay');
hold on;
plot(data_maxdelay(:,1), data_maxdelay(:,2), symbol);

data_totalenergy = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+4);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_totalenergy = [data_totalenergy; data(ifirst, 1:cols-6), avg ci];
end

fig4 = figure(4);
set(fig4,'Name','data_totalenergy');
hold on;
plot(data_totalenergy(:,1), data_totalenergy(:,2), symbol);


%-------- Saturation Analysis -----------
slope=[];
for i=2:size(data_throughput,1),
    slope(i-1) = (data_throughput(i,2)-data_throughput(i-1,2))/(data_throughput(i,1)-data_throughput(i-1,1));
end

for i=2:size(slope,2),
    if slope(i) < (0.95*mean(slope(1:i)))
        max_pir = data_throughput(i, 1);
        max_throughput = data_throughput(i, 2);
        min_delay = data_delay(i, 2);
        break;
    end
end
