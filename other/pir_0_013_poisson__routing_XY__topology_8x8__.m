% fname: pir_0_013_poisson__routing_XY__topology_8x8__.m
% ../bin/noxim -pir 0.013 poisson -routing XY -topology MESH -dimx 8 -dimy 8  -warmup 900 -size 8 8 -buffer 4 -config ../config_examples/default_config.yaml -power ../bin/power.yaml 

function [max_pir, max_throughput, min_delay] = pir_0_013_poisson__routing_XY__topology_8x8__(symbol)

data = [
%             sim      avg_delay     throughput      max_delay   total_energy       rpackets         rflits
             1000        32.7108       0.103906             99    9.14966e-07             83            665
             1000        32.7108       0.103906             99    9.14966e-07             83            665
             1000        33.5679       0.101719            120    9.20078e-07             81            651
             1000        33.5679       0.101719            120    9.20078e-07             81            651
             1000        33.5679       0.101719            120    9.20078e-07             81            651
             1000        33.5679       0.101719            120    9.20078e-07             81            651
             1000        32.5571      0.0885937            102    9.18049e-07             70            567
             1000        32.5571      0.0885937            102    9.18049e-07             70            567
             1000        32.5571      0.0885937            102    9.18049e-07             70            567
             1000        32.5571      0.0885937            102    9.18049e-07             70            567
             2000        28.4113      0.0960938            176    1.83052e-06            846           6765
             2000         33.286       0.103381            163    1.83677e-06            909           7278
             2000         33.286       0.103381            163    1.83677e-06            909           7278
             2000        42.1575       0.107457            302    1.85094e-06            946           7565
             2000        42.1575       0.107457            302    1.85094e-06            946           7565
             2000        42.1575       0.107457            302    1.85094e-06            946           7565
             2000        31.4605        0.10233            176    1.83305e-06            899           7204
             2000        31.4605        0.10233            176    1.83305e-06            899           7204
             2000        31.4605        0.10233            176    1.83305e-06            899           7204
             2000        38.6959       0.105142            199    1.83454e-06            924           7402
             3000         44.505       0.106912            263    2.76538e-06           1796          14369
             3000        34.5793       0.104874            280    2.76253e-06           1766          14095
             3000        34.5793       0.104874            280    2.76253e-06           1766          14095
             3000         37.099       0.102924            225    2.75481e-06           1727          13833
             3000         37.099       0.102924            225    2.75481e-06           1727          13833
             3000        45.6758       0.106763            427    2.76481e-06           1792          14349
             3000        45.6758       0.106763            427    2.76481e-06           1792          14349
             3000        35.5693      0.0981399            447    2.74408e-06           1653          13190
             3000        35.5693      0.0981399            447    2.74408e-06           1653          13190
             3000        35.5693      0.0981399            447    2.74408e-06           1653          13190
             4000        32.8032       0.104118            236    3.66817e-06           2581          20657
             4000        35.9112       0.104597            266    3.67706e-06           2591          20752
             4000        35.9112       0.104597            266    3.67706e-06           2591          20752
             4000        39.8202       0.103962            388    3.68551e-06           2580          20626
             4000         37.884       0.103175            359    3.68226e-06           2561          20470
             4000         37.884       0.103175            359    3.68226e-06           2561          20470
             4000        34.4652        0.10192            257    3.67813e-06           2528          20221
             4000        34.4652        0.10192            257    3.67813e-06           2528          20221
             4000        33.3396       0.102258            248    3.67811e-06           2538          20288
             4000        38.7776        0.10248            530    3.67514e-06           2541          20332
             5000        37.9196       0.104021            530    4.59967e-06           3409          27295
             5000        39.3406       0.103293            429    4.58671e-06           3388          27104
             5000        32.8013       0.104242            224    4.60884e-06           3418          27353
             5000        31.7783       0.101475            263    4.58245e-06           3333          26627
             5000        31.7783       0.101475            263    4.58245e-06           3333          26627
             5000        41.9435       0.107999            368     4.6278e-06           3541          28339
             5000        34.7504       0.103304            399    4.59872e-06           3390          27107
             5000        36.2861       0.105918            312    4.61444e-06           3474          27793
             5000        36.2861       0.105918            312    4.61444e-06           3474          27793
             5000        42.2459        0.10484            389    4.61531e-06           3436          27510
             6000        38.3872       0.103961            345    5.52181e-06           4243          33933
             6000        35.8773       0.103398            410    5.52403e-06           4215          33749
             6000        39.1957       0.104485            638    5.52561e-06           4262          34104
             6000        32.2135       0.103039            220    5.52295e-06           4202          33632
             6000        36.6186       0.103018            348     5.5146e-06           4206          33625
             6000        33.9513       0.102175            289     5.5071e-06           4167          33350
             6000        33.9513       0.102175            289     5.5071e-06           4167          33350
             6000        33.8733       0.102831            253    5.50676e-06           4191          33564
             6000        37.0807       0.106532            350    5.54664e-06           4350          34772
             6000        36.8041       0.104384            311    5.52973e-06           4253          34071
             7000        32.7887        0.10125            286    6.42573e-06           4940          39528
             7000        35.4273       0.106109            293    6.45915e-06           5181          41425
             7000        32.8261        0.10415            264    6.45074e-06           5083          40660
             7000        36.1255        0.10522            276    6.45852e-06           5133          41078
             7000        30.9976       0.101399            201    6.40938e-06           4946          39586
             7000        35.0725       0.103143            339    6.44526e-06           5033          40267
             7000        34.3295       0.102351            327    6.44412e-06           4992          39958
             7000        37.1043       0.104137            357    6.45519e-06           5082          40655
             7000        37.7674       0.103835            540    6.45547e-06           5068          40537
             7000        35.5998       0.104956            272    6.45542e-06           5123          40975
             8000        37.5919       0.104162            351    7.36614e-06           5918          47331
             8000        38.5999        0.10546            553    7.38164e-06           5989          47921
             8000        35.4748       0.101855            338    7.35747e-06           5786          46283
             8000        39.0694       0.106045            397    7.37879e-06           6024          48187
             8000        34.0414        0.10368            347    7.36094e-06           5889          47112
             8000        39.5248       0.104996            497    7.38201e-06           5962          47710
             8000        35.2713       0.101908            398    7.35304e-06           5790          46307
             8000        41.0961       0.105176            531    7.38524e-06           5976          47792
             8000        38.5232       0.105268            387    7.37515e-06           5979          47834
             8000        33.8965       0.103783            286    7.36656e-06           5894          47159
             9000        38.0676       0.105257            327    8.32056e-06           6818          54565
             9000        33.1398       0.101601            244    8.26061e-06           6581          52670
             9000        35.1866       0.102525            271    8.27607e-06           6641          53149
             9000        34.8105       0.106115            377    8.30873e-06           6876          55010
             9000        33.1608       0.102629            270      8.274e-06           6650          53203
             9000        35.2368       0.103337            343    8.28588e-06           6697          53570
             9000        33.5402        0.10537            229    8.30635e-06           6827          54624
             9000        35.3606       0.104365            323     8.2965e-06           6759          54103
             9000        34.5672       0.104275            356    8.28012e-06           6759          54056
             9000        37.6271       0.103758            442    8.28291e-06           6725          53788
            10000        35.4559       0.105556            302    9.22626e-06           7683          61476
            10000        38.3384       0.104516            601    9.22828e-06           7609          60870
            10000        36.1779       0.105237            382    9.22885e-06           7663          61290
            10000         38.707       0.105106            525    9.22847e-06           7652          61214
            10000        34.3529        0.10524            268    9.21533e-06           7660          61292
            10000         35.401       0.104633            416    9.20405e-06           7616          60938
            10000        32.4359       0.103401            251    9.20047e-06           7531          60221
            10000        37.4359       0.105743            332     9.2349e-06           7697          61585
            10000         34.945       0.105362            325    9.22153e-06           7671          61363
            10000        37.0776       0.103163            500     9.1966e-06           7512          60082
            11000         36.092       0.104336            449    1.01389e-05           8433          67443
            11000         36.512       0.104745            310    1.01467e-05           8459          67707
            11000        35.3856       0.104372            455    1.01255e-05           8431          67466
            11000        35.0262       0.103895            321    1.01241e-05           8396          67158
            11000        37.6287       0.105746            326    1.01567e-05           8546          68354
            11000         35.543       0.105679            258    1.01442e-05           8538          68311
            11000        35.7557       0.103476            298    1.01337e-05           8359          66887
            11000        35.1593       0.103201            390    1.01134e-05           8338          66709
            11000        37.3858        0.10461            362    1.01349e-05           8456          67620
            11000        34.7527       0.103594            402    1.01257e-05           8371          66963
            12000         35.503       0.104351            393     1.1064e-05           9264          74131
            12000        37.6771       0.104641            528    1.10678e-05           9292          74337
            12000        34.2585       0.105374            436     1.1059e-05           9357          74858
            12000        34.0591       0.104523            356     1.1062e-05           9283          74253
            12000        37.7835       0.103242            728    1.10493e-05           9168          73343
            12000        34.2879       0.102893            373    1.10419e-05           9134          73095
            12000        32.9881       0.103059            254    1.10368e-05           9155          73213
            12000        36.3499       0.104726            350    1.10808e-05           9301          74397
            12000        37.1528       0.103521            390    1.10493e-05           9193          73541
            12000        38.4326       0.103452            444    1.10513e-05           9187          73492
            13000        37.0254       0.102293            447    1.19562e-05           9899          79216
            13000        36.6606       0.105529            336    1.19941e-05          10216          81722
            13000        36.7148        0.10516            330    1.19938e-05          10183          81436
            13000        35.3407       0.102133            366    1.19453e-05           9889          79092
            13000         33.573       0.103076            278    1.19552e-05           9978          79822
            13000        34.4379       0.102735            375    1.19597e-05           9944          79558
            13000        37.2033       0.103533            344     1.1965e-05          10022          80176
            13000        35.8812       0.105294            374     1.1987e-05          10191          81540
            13000        39.5459       0.104766            808    1.19817e-05          10142          81131
            13000        37.2832       0.104127            601    1.19933e-05          10076          80636
            14000        35.7997       0.104167            354    1.29007e-05          10921          87334
            14000        37.7171       0.104666            360    1.28969e-05          10970          87752
            14000        37.6955       0.104351            338    1.29013e-05          10935          87488
            14000        36.7255       0.106298            420    1.29469e-05          11140          89120
            14000        34.9306       0.103435            264    1.28862e-05          10837          86720
            14000        36.0845       0.103655            366    1.28981e-05          10864          86904
            14000        37.4762       0.104034            399    1.28862e-05          10902          87222
            14000        33.7496       0.102696            284    1.28537e-05          10765          86100
            14000        36.2314       0.104735            446     1.2907e-05          10976          87810
            14000        34.7604       0.102356            307    1.28849e-05          10725          85815
            15000        34.8594       0.102778            359     1.3815e-05          11595          92747
            15000        34.6925       0.103523            407    1.38079e-05          11679          93419
            15000        34.2726       0.103167            276    1.38068e-05          11638          93098
            15000        37.0668       0.104314            319     1.3821e-05          11767          94133
            15000        37.2335       0.104028            357    1.38189e-05          11732          93875
            15000        35.3046        0.10378            584    1.38096e-05          11703          93651
            15000        36.0332       0.102566            338    1.37902e-05          11569          92556
            15000        36.3471        0.10494            403    1.38486e-05          11837          94698
            15000        34.8111       0.104697            312    1.38216e-05          11811          94479
            15000        36.8382        0.10485            311    1.38294e-05          11825          94617
            16000        35.6505       0.103319            428    1.47206e-05          12476          99847
            16000        35.8354       0.103952            299    1.47354e-05          12556         100459
            16000        34.3345       0.103145            308    1.47109e-05          12459          99679
            16000        35.2818       0.103903            328    1.47405e-05          12550         100412
            16000        34.0351       0.103282            273    1.47226e-05          12477          99812
            16000        35.3526        0.10465            340    1.47589e-05          12645         101134
            16000        34.6696       0.103541            448    1.47185e-05          12505         100062
            16000         36.521       0.104478            457    1.47574e-05          12625         100968
            16000         37.677       0.103692            581     1.4735e-05          12531         100208
            16000         36.131       0.104476            328    1.47598e-05          12622         100966
            17000        35.0129       0.103299            307    1.56534e-05          13312         106439
            17000        34.4369       0.103238            336    1.56348e-05          13299         106376
            17000        36.9723       0.104934            595    1.56808e-05          13518         108124
            17000        36.0365       0.103179            403     1.5639e-05          13287         106316
            17000        35.4245       0.104586            318    1.56687e-05          13472         107765
            17000        36.3843       0.103763            357    1.56682e-05          13364         106917
            17000        36.4942        0.10374            563      1.567e-05          13360         106894
            17000        34.2343       0.103444            315    1.56473e-05          13323         106589
            17000        36.0629       0.104672            304    1.56774e-05          13483         107854
            17000        35.6067       0.103477            338    1.56428e-05          13327         106623
            18000        35.8325       0.102696            331     1.6545e-05          14047         112390
            18000        34.5741       0.103785            435      1.657e-05          14200         113582
            18000        34.9651       0.102361            544    1.65493e-05          14001         112024
            18000        35.4103       0.104295            325    1.65793e-05          14269         114140
            18000        37.0448       0.104755            323    1.65995e-05          14331         114644
            18000        37.9023       0.104182            536    1.65911e-05          14251         114017
            18000        35.7775       0.104531            282    1.66106e-05          14304         114399
            18000        35.0343       0.102215            358    1.65506e-05          13983         111864
            18000        33.8546       0.102793            338    1.65474e-05          14063         112497
            18000        36.3114       0.105375            602     1.6615e-05          14417         115322
            19000        35.8979       0.104162            399    1.75198e-05          15082         120661
            19000        35.6224       0.104268            457    1.75171e-05          15097         120784
            19000        35.1489       0.103591            457    1.74977e-05          14999         120000
            19000        36.4916        0.10441            369    1.75224e-05          15116         120949
            19000        35.0247       0.103569            458    1.74742e-05          14998         119974
            19000        34.9767       0.103907            375    1.74969e-05          15044         120366
            19000        36.1663       0.103321            417    1.74904e-05          14963         119687
            19000        35.8397       0.103695            364    1.74783e-05          15016         120120
            19000        36.3914       0.104204            473    1.74804e-05          15085         120710
            19000        36.3303       0.104569            336    1.75174e-05          15146         121133
            20000        35.8009       0.103215            503    1.84093e-05          15768         126170
            20000        36.4266       0.104865            475    1.84467e-05          16022         128187
            20000        36.6733       0.104475            401    1.84165e-05          15966         127710
            20000        36.3097       0.104894            343    1.84714e-05          16027         128222
            20000        36.8923       0.102636            434    1.84174e-05          15681         125462
            20000        35.6739        0.10431            319    1.84385e-05          15935         127508
            20000         36.681       0.104574            366    1.84486e-05          15983         127831
            20000        34.0855       0.102918            449    1.84026e-05          15724         125807
            20000        38.3816       0.104614            621    1.84589e-05          15986         127880
            20000        33.8295       0.104421            541    1.84203e-05          15957         127644
];

rows = size(data, 1);
cols = size(data, 2);

data_delay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+1);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_delay = [data_delay; data(ifirst, 1:cols-6), avg ci];
end

fig1 = figure(1);
set(fig1,'Name','data_delay');
hold on;
plot(data_delay(:,1), data_delay(:,2), symbol);

data_throughput = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+2);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_throughput = [data_throughput; data(ifirst, 1:cols-6), avg ci];
end

fig2 = figure(2);
set(fig2,'Name','data_throughput');
hold on;
plot(data_throughput(:,1), data_throughput(:,2), symbol);

data_maxdelay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+3);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_maxdelay = [data_maxdelay; data(ifirst, 1:cols-6), avg ci];
end

fig3 = figure(3);
set(fig3,'Name','data_maxdelay');
hold on;
plot(data_maxdelay(:,1), data_maxdelay(:,2), symbol);

data_totalenergy = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+4);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_totalenergy = [data_totalenergy; data(ifirst, 1:cols-6), avg ci];
end

fig4 = figure(4);
set(fig4,'Name','data_totalenergy');
hold on;
plot(data_totalenergy(:,1), data_totalenergy(:,2), symbol);


%-------- Saturation Analysis -----------
slope=[];
for i=2:size(data_throughput,1),
    slope(i-1) = (data_throughput(i,2)-data_throughput(i-1,2))/(data_throughput(i,1)-data_throughput(i-1,1));
end

for i=2:size(slope,2),
    if slope(i) < (0.95*mean(slope(1:i)))
        max_pir = data_throughput(i, 1);
        max_throughput = data_throughput(i, 2);
        min_delay = data_delay(i, 2);
        break;
    end
end
