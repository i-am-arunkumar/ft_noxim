% fname: pir_0_011_poisson__routing_XY__topology_8x8__.m
% ../bin/noxim -pir 0.011 poisson -routing XY -topology MESH -dimx 8 -dimy 8  -warmup 900 -size 8 8 -buffer 4 -config ../config_examples/default_config.yaml -power ../bin/power.yaml 

function [max_pir, max_throughput, min_delay] = pir_0_011_poisson__routing_XY__topology_8x8__(symbol)

data = [
%             sim      avg_delay     throughput      max_delay   total_energy       rpackets         rflits
             1000        23.5714       0.094375             74    9.02602e-07             77            604
             1000        23.5714       0.094375             74    9.02602e-07             77            604
             1000        23.5714       0.094375             74    9.02602e-07             77            604
             1000         33.137          0.095            113    8.98295e-07             73            608
             1000         33.137          0.095            113    8.98295e-07             73            608
             1000         33.137          0.095            113    8.98295e-07             73            608
             1000         33.137          0.095            113    8.98295e-07             73            608
             1000         33.137          0.095            113    8.98295e-07             73            608
             1000         21.597      0.0801562             55    8.90257e-07             67            513
             1000         21.597      0.0801562             55    8.90257e-07             67            513
             2000        26.7445      0.0871023            113    1.78985e-06            771           6132
             2000        26.7445      0.0871023            113    1.78985e-06            771           6132
             2000         33.179      0.0886506            219    1.79678e-06            782           6241
             2000         33.179      0.0886506            219    1.79678e-06            782           6241
             2000         33.179      0.0886506            219    1.79678e-06            782           6241
             2000        29.2453      0.0895597            281    1.80065e-06            791           6305
             2000        29.2453      0.0895597            281    1.80065e-06            791           6305
             2000        29.2453      0.0895597            281    1.80065e-06            791           6305
             2000        29.2453      0.0895597            281    1.80065e-06            791           6305
             2000        23.3618      0.0851705             89    1.79178e-06            749           5996
             3000         25.804       0.086942            168    2.69475e-06           1459          11685
             3000         26.182      0.0871652            174    2.70014e-06           1467          11715
             3000         26.182      0.0871652            174    2.70014e-06           1467          11715
             3000         26.182      0.0871652            174    2.70014e-06           1467          11715
             3000        28.0625      0.0875223            180    2.70039e-06           1473          11763
             3000        28.0625      0.0875223            180    2.70039e-06           1473          11763
             3000        25.9434       0.088497            162    2.69443e-06           1485          11894
             3000        25.9434       0.088497            162    2.69443e-06           1485          11894
             3000        25.9434       0.088497            162    2.69443e-06           1485          11894
             3000        28.1503      0.0909449            147    2.70601e-06           1530          12223
             4000          28.38      0.0879133            172    3.60072e-06           2179          17442
             4000        25.2266      0.0875353            175    3.59235e-06           2171          17367
             4000        25.2266      0.0875353            175    3.59235e-06           2171          17367
             4000        28.8932      0.0882308            179    3.60625e-06           2192          17505
             4000        28.8932      0.0882308            179    3.60625e-06           2192          17505
             4000        29.4522      0.0906754            292    3.60971e-06           2249          17990
             4000        29.4522      0.0906754            292    3.60971e-06           2249          17990
             4000         29.072      0.0902167            216    3.61083e-06           2237          17899
             4000        26.5892      0.0901915            188    3.60091e-06           2237          17894
             4000        26.5892      0.0901915            188    3.60091e-06           2237          17894
             5000        27.7636      0.0853773            326    4.48453e-06           2800          22403
             5000        27.7636      0.0853773            326    4.48453e-06           2800          22403
             5000        27.9057      0.0885899            199    4.50924e-06           2905          23246
             5000        27.9057      0.0885899            199    4.50924e-06           2905          23246
             5000        27.2469      0.0875457            189    4.50258e-06           2872          22972
             5000        26.7931      0.0876639            178    4.49817e-06           2876          23003
             5000        26.7931      0.0876639            178    4.49817e-06           2876          23003
             5000        26.9402       0.086654            167    4.49412e-06           2844          22738
             5000        28.1392      0.0866349            227    4.49737e-06           2844          22733
             5000        28.1392      0.0866349            227    4.49737e-06           2844          22733
             6000        27.3135      0.0895129            196    5.40823e-06           3652          29217
             6000        27.3039      0.0870711            230    5.40229e-06           3550          28420
             6000        27.3039      0.0870711            230    5.40229e-06           3550          28420
             6000        26.2245      0.0890564            182    5.41095e-06           3631          29068
             6000        27.0893      0.0889553            154    5.41858e-06           3630          29035
             6000        25.5923      0.0873866            133    5.39859e-06           3564          28523
             6000        25.5923      0.0873866            133    5.39859e-06           3564          28523
             6000        27.0119      0.0887102            217    5.39831e-06           3621          28955
             6000        27.7501      0.0887347            225    5.40508e-06           3625          28963
             6000        25.9443      0.0858762            165    5.37935e-06           3503          28030
             7000         26.289      0.0859221            171    6.27682e-06           4194          33544
             7000        27.1626      0.0880789            184    6.30873e-06           4304          34386
             7000        26.3839      0.0881865            197    6.29516e-06           4301          34428
             7000        26.8474      0.0881993            222    6.31528e-06           4305          34433
             7000        26.5869      0.0869211            159    6.29793e-06           4241          33934
             7000        26.3231      0.0863243            248    6.28987e-06           4216          33701
             7000        26.3231      0.0863243            248    6.28987e-06           4216          33701
             7000        26.5836      0.0876434            174    6.29392e-06           4277          34216
             7000         26.049      0.0878381            181     6.3005e-06           4286          34292
             7000        27.0217      0.0888653            208      6.314e-06           4334          34693
             8000        28.1796      0.0894586            190     7.2196e-06           5083          40650
             8000        27.8898      0.0872139            262    7.18643e-06           4953          39630
             8000         27.623      0.0893266            220    7.22211e-06           5074          40590
             8000        28.3134      0.0884463            208    7.20826e-06           5026          40190
             8000        28.4413      0.0887148            238    7.20867e-06           5037          40312
             8000        27.6177      0.0876673            279    7.20083e-06           4978          39836
             8000        29.0321      0.0911642            200    7.24221e-06           5179          41425
             8000        26.5243      0.0873261            250    7.20039e-06           4961          39681
             8000        27.6212      0.0886598            170    7.21603e-06           5037          40287
             8000         24.873      0.0874406            171    7.19414e-06           4968          39733
             9000        27.4864      0.0889217            248    8.11981e-06           5763          46097
             9000        28.8178      0.0895428            221    8.11476e-06           5802          46419
             9000        26.5306      0.0867708            171    8.08645e-06           5624          44982
             9000        27.2888      0.0876775            177    8.10274e-06           5682          45452
             9000        28.9671      0.0904765            253    8.13212e-06           5863          46903
             9000        26.4301      0.0873225            230    8.10856e-06           5659          45268
             9000        25.9567      0.0863773            195    8.08586e-06           5594          44778
             9000        26.4392      0.0881732            202      8.106e-06           5711          45709
             9000        26.4705      0.0881057            205    8.10394e-06           5711          45674
             9000        27.1892      0.0902392            184    8.13869e-06           5846          46780
            10000        26.2152      0.0874038            269    8.99197e-06           6362          50904
            10000         26.617      0.0874073            169    9.01793e-06           6363          50906
            10000         27.535      0.0887689            225    9.02464e-06           6458          51699
            10000        26.4307      0.0858242            286    8.97282e-06           6246          49984
            10000        29.5242      0.0895055            295    9.02181e-06           6513          52128
            10000        27.4303      0.0882606            327    9.00808e-06           6423          51403
            10000        26.9305       0.087749            222    8.99519e-06           6389          51105
            10000        27.3522      0.0878932            240    9.00878e-06           6394          51189
            10000        27.3169      0.0887483            258    9.02305e-06           6460          51687
            10000         26.803      0.0861401            210    8.98804e-06           6280          50168
            11000        27.3136      0.0881977            296    9.91289e-06           7127          57011
            11000        25.2324      0.0860056            217    9.87514e-06           6949          55594
            11000        25.7693      0.0859839            211    9.87287e-06           6947          55580
            11000         28.348      0.0885551            302    9.91728e-06           7156          57242
            11000         27.526      0.0872355            206    9.90694e-06           7049          56389
            11000         26.968      0.0885845            208    9.91441e-06           7157          57261
            11000        26.5659      0.0879192            178    9.91074e-06           7104          56831
            11000        29.1891      0.0884901            325    9.91364e-06           7149          57200
            11000        26.0412      0.0871318            157    9.89691e-06           7041          56322
            11000        28.2425      0.0879842            322    9.89495e-06           7112          56873
            12000        26.7952       0.088239            154    1.08017e-05           7836          62685
            12000        27.2039      0.0884628            204    1.08125e-05           7857          62844
            12000        27.5389      0.0868834            262     1.0781e-05           7718          61722
            12000        27.8845       0.088857            335    1.08251e-05           7888          63124
            12000        26.7772       0.087538            205    1.08099e-05           7771          62187
            12000        26.4219      0.0881475            194    1.08153e-05           7827          62620
            12000        26.0014      0.0883559            190    1.07981e-05           7843          62768
            12000        26.5433      0.0878491            275    1.07923e-05           7800          62408
            12000        26.7825      0.0852956            259    1.07739e-05           7572          60594
            12000        26.7202      0.0877309            275    1.07972e-05           7790          62324
            13000        26.2082      0.0864979            229    1.16943e-05           8377          66984
            13000        28.0315       0.089672            205     1.1741e-05           8680          69442
            13000        26.8414       0.087509            267    1.16974e-05           8468          67767
            13000        28.3003      0.0892084            241    1.17236e-05           8639          69083
            13000        27.2188      0.0873644            251    1.17076e-05           8460          67655
            13000        27.7377      0.0887423            267    1.17369e-05           8588          68722
            13000        26.6968      0.0871991            225    1.17008e-05           8441          67527
            13000        26.1927      0.0875478            293    1.16951e-05           8474          67797
            13000        27.5184      0.0890974            208    1.17307e-05           8624          68997
            13000        27.9595      0.0877596            250    1.17158e-05           8493          67961
            14000        26.9506      0.0872877            201    1.26121e-05           9148          73182
            14000        27.1378      0.0871195            251    1.26006e-05           9132          73041
            14000        28.1526      0.0879735            388    1.26121e-05           9222          73757
            14000        26.9927      0.0881274            187    1.26133e-05           9234          73886
            14000        28.5412       0.089412            328    1.26294e-05           9372          74963
            14000          27.71      0.0876324            319    1.25971e-05           9184          73471
            14000        28.1045      0.0886236            339    1.26201e-05           9289          74302
            14000        28.1928      0.0888383            246    1.26326e-05           9310          74482
            14000        27.2054      0.0861641            234    1.25879e-05           9031          72240
            14000        27.4925      0.0882288            342    1.26116e-05           9247          73971
            15000         26.406       0.087367            259    1.35017e-05           9853          78840
            15000         27.025      0.0879721            254    1.35231e-05           9923          79386
            15000        26.8484      0.0876441            225    1.34969e-05           9885          79090
            15000        26.9669      0.0883411            216    1.35192e-05           9963          79719
            15000        27.4167      0.0887733            222    1.35187e-05          10012          80109
            15000        26.8572       0.087295            208    1.34969e-05           9847          78775
            15000        28.1526      0.0886591            248    1.35292e-05          10002          80006
            15000        26.7016      0.0886979            178     1.3521e-05          10000          80041
            15000        27.9736      0.0887844            204    1.35417e-05          10013          80119
            15000        27.0508      0.0877571            203    1.35203e-05           9904          79192
            16000        27.4227      0.0882254            235    1.44185e-05          10655          85261
            16000        26.6682      0.0869981            260    1.44003e-05          10510          84075
            16000        26.6234       0.087858            364    1.44108e-05          10610          84906
            16000        27.3927      0.0879439            246    1.44201e-05          10624          84989
            16000        27.4408       0.088156            335    1.44218e-05          10652          85194
            16000        27.3812      0.0883444            320    1.44226e-05          10670          85376
            16000           26.4      0.0858837            219    1.43725e-05          10376          82998
            16000        28.5269      0.0891287            328    1.44345e-05          10766          86134
            16000        28.8164      0.0894888            253    1.44641e-05          10811          86482
            16000        27.5922      0.0872537            261    1.44046e-05          10540          84322
            17000        27.7656       0.087666            412    1.53132e-05          11291          90331
            17000          26.94      0.0875602            253    1.53156e-05          11278          90222
            17000        27.4932      0.0884569            305    1.53211e-05          11393          91146
            17000        26.1804      0.0866974            243    1.52871e-05          11167          89333
            17000         28.337      0.0902795            197    1.53721e-05          11628          93024
            17000         26.481      0.0869711            200    1.52941e-05          11202          89615
            17000        27.7147      0.0899922            235    1.53475e-05          11593          92728
            17000        26.9219       0.088324            245    1.53245e-05          11376          91009
            17000        27.2867      0.0887189            218    1.53252e-05          11425          91416
            17000        26.9557      0.0878144            261    1.52922e-05          11312          90484
            18000        26.3001      0.0872633            202    1.61958e-05          11938          95501
            18000        27.3661      0.0885992            182    1.62351e-05          12118          96963
            18000        27.6205      0.0877595            245    1.62115e-05          12002          96044
            18000        26.7615      0.0862445            219    1.61856e-05          11799          94386
            18000        27.0764      0.0869097            179    1.61991e-05          11890          95114
            18000        27.0195      0.0882621            218    1.62266e-05          12072          96594
            18000        26.8249      0.0881871            200     1.6222e-05          12064          96512
            18000        26.9227      0.0876179            236    1.62148e-05          11983          95889
            18000        26.2156      0.0873227            215    1.61879e-05          11944          95566
            18000        27.5442      0.0872734            273    1.62219e-05          11937          95512
            19000         26.197      0.0869492            238    1.70849e-05          12589         100722
            19000        26.8833      0.0864019            326    1.70866e-05          12512         100088
            19000        28.1855      0.0886007            282    1.71416e-05          12829         102635
            19000        27.2246      0.0882838            231    1.71213e-05          12785         102268
            19000        27.6758      0.0884763            248    1.71222e-05          12814         102491
            19000        26.8041      0.0867015            240    1.70983e-05          12556         100435
            19000         27.028      0.0881785            217    1.71249e-05          12768         102146
            19000        27.5638      0.0886525            210     1.7124e-05          12837         102695
            19000        26.8161      0.0878194            233    1.70951e-05          12717         101730
            19000        26.4318        0.08738            285    1.70873e-05          12653         101221
            20000        27.2681      0.0874902            262    1.80087e-05          13370         106948
            20000        27.4198      0.0889046            276    1.80418e-05          13584         108677
            20000        27.0798      0.0875884            258    1.80229e-05          13381         107068
            20000        27.2567      0.0877078            347    1.80142e-05          13408         107214
            20000        27.4245      0.0890993            266    1.80483e-05          13614         108915
            20000        27.8139      0.0890445            245    1.80516e-05          13603         108848
            20000        26.4004      0.0873323            199    1.80039e-05          13345         106755
            20000        27.3059      0.0893529            186    1.80564e-05          13656         109225
            20000         28.083      0.0887402            350    1.80532e-05          13560         108476
            20000        26.7825      0.0869454            256    1.79902e-05          13285         106282
];

rows = size(data, 1);
cols = size(data, 2);

data_delay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+1);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_delay = [data_delay; data(ifirst, 1:cols-6), avg ci];
end

fig1 = figure(1);
set(fig1,'Name','data_delay');
hold on;
plot(data_delay(:,1), data_delay(:,2), symbol);

data_throughput = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+2);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_throughput = [data_throughput; data(ifirst, 1:cols-6), avg ci];
end

fig2 = figure(2);
set(fig2,'Name','data_throughput');
hold on;
plot(data_throughput(:,1), data_throughput(:,2), symbol);

data_maxdelay = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+3);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_maxdelay = [data_maxdelay; data(ifirst, 1:cols-6), avg ci];
end

fig3 = figure(3);
set(fig3,'Name','data_maxdelay');
hold on;
plot(data_maxdelay(:,1), data_maxdelay(:,2), symbol);

data_totalenergy = [];
for i = 1:rows/10,
   ifirst = (i - 1) * 10 + 1;
   ilast  = ifirst + 10 - 1;
   tmp = data(ifirst:ilast, cols-6+4);
   avg = mean(tmp);
   [h sig ci] = ttest(tmp, 0.1);
   ci = (ci(2)-ci(1))/2;
   data_totalenergy = [data_totalenergy; data(ifirst, 1:cols-6), avg ci];
end

fig4 = figure(4);
set(fig4,'Name','data_totalenergy');
hold on;
plot(data_totalenergy(:,1), data_totalenergy(:,2), symbol);


%-------- Saturation Analysis -----------
slope=[];
for i=2:size(data_throughput,1),
    slope(i-1) = (data_throughput(i,2)-data_throughput(i-1,2))/(data_throughput(i,1)-data_throughput(i-1,1));
end

for i=2:size(slope,2),
    if slope(i) < (0.95*mean(slope(1:i)))
        max_pir = data_throughput(i, 1);
        max_throughput = data_throughput(i, 2);
        min_delay = data_delay(i, 2);
        break;
    end
end
